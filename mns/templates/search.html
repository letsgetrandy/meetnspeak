{% extends "base.html" %}

{% block title %}Search{% endblock %}

{% block styles %}
{{ block.super }}
<style>
.head {
    border-radius:10px;
    overflow:hidden;
    position:relative;
}
.head .content {
    color:#999;
    left:0px;
    line-height:2em;
    text-align:center;
    text-shadow:1px 1px 6px #000;
    top:0px;
}
main {
    padding:1em;
}
#map_canvas {
    height:300px;
}
</style>
{% endblock %}

{% block body %}
<header>
<div class="head">
    <div class="content">Search</div>
</div>
</header>

<main>
<div class="split">
    <div id="map_canvas"></div>
    <div id="listing">
        <div class="field"><button class="search">Search</button></div>
        <ul>
            <li>blah </li>
            <li>blah </li>
            <li>blah </li>
        </ul>
    </div>
</div>
</main>

<footer>
</footer>
{% endblock %}

{% block scripts %}
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true" type="text/javascript"></script>
{{ block.super }}
<script>
$("#listing button.search").click(function(event){
    do_search({lat:41.877114, lng:-87.643548});
});
function do_search(position) {
    $.ajax({
        async: true,
        data: {
            pos: position.lat + "," + position.lng,
            langs:['EN','SP']
            },
        type: 'GET',
        url: '{% url search-ajax %}'
    }).done(function(data) {
        //
        console.log(data);
    }).fail(function(xhr){
        //
        console.log(xhr);
    }).always(function(){
        //
        //console.log('always');
    });
}

mg = new MapGeo({
    mapdiv: 'map_canvas',
    on_geo: function(position) {
            do_search(position);
            $('button.search').prop('disabled',false).click(function(event) {
                do_search(position);
            });
        }
});


//$('button.search').click(do_search);

</script>
{% endblock %}
